<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>hexo+git搭建个人博客</title>
    <url>/2019/11/29/hexo+git%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>以下步骤均在centos7上执行</p>
<p>环境准备和安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install git-core -y  //安装git</span></pre></td></tr><tr><td class="code"><pre><span class="line">wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | sh  //安装node.js,重启服务器执行以下</span></pre></td></tr><tr><td class="code"><pre><span class="line">nvm install nod		//安装node</span></pre></td></tr><tr><td class="code"><pre><span class="line">npm install -g hexo-cli		//安装hexo</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">hexo init Blog		//在当前位置创建hexo工作目录,可自选</span></pre></td></tr><tr><td class="code"><pre><span class="line">cd Blog/		//进入目录</span></pre></td></tr><tr><td class="code"><pre><span class="line">install	</span></pre></td></tr><tr><td class="code"><pre><span class="line">hexo g			//生成静态网页</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">hexo -v			//查看版本</span></pre></td></tr><tr><td class="code"><pre><span class="line">hexo s &amp;		//后台启动,此时可在浏览器输入本机ip和端口号访问博客</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save		//和git联系用</span></pre></td></tr></table></figure>


<p>配置git<br>创建一个库，库名为用户名.github.io,如TheKool.github.io<br>此时可以看到一栏https/ssh，点击ssh，复制后面的地址，我的是<a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:TheKool/TheKool.github.io.git后面配置站点配置文件要用到<br>在seeting里下拉创建一个pages</p>
<p>设置Git的user name和email</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name "TheKool"</span></pre></td></tr><tr><td class="code"><pre><span class="line">git config --global user.email "1932944168@qq.com"</span></pre></td></tr></table></figure>

<p>配置密钥登录git</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C "1932944168@qq.com" //生成密钥,连续三个回车</span></pre></td></tr><tr><td class="code"><pre><span class="line">eval "$(ssh-agent -s)" //设置自动启动 ssh-agent</span></pre></td></tr><tr><td class="code"><pre><span class="line">ssh-add ~/.ssh/id_rsa  //添加生成的 SSH key 到 ssh-agen</span></pre></td></tr><tr><td class="code"><pre><span class="line">vim /root/.ssh/id_rsa.pub</span></pre></td></tr><tr><td class="code"><pre><span class="line">登陆Github, 添加 ssh,把id_rsa.pub文件里的内容复制到SSH KEY</span></pre></td></tr><tr><td class="code"><pre><span class="line">ssh -T git@github.com  //测试是否成功</span></pre></td></tr><tr><td class="code"><pre><span class="line">Hi TheKool! You've successfully authenticated, but GitHub does not provide shell access.</span></pre></td></tr><tr><td class="code"><pre><span class="line">看到以上成功</span></pre></td></tr></table></figure>

<p>站点配置文件配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim _config.yml    //配置以下</span></pre></td></tr><tr><td class="code"><pre><span class="line">deploy:</span></pre></td></tr><tr><td class="code"><pre><span class="line">  type: git</span></pre></td></tr><tr><td class="code"><pre><span class="line">  repo: git@github.com:TheKool/TheKool.github.io.git</span></pre></td></tr><tr><td class="code"><pre><span class="line">  branch: master</span></pre></td></tr></table></figure>
<p>配置完成后执行以下,即可发布到github</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo deploy</span></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>MySQL互为主从(GTID)</title>
    <url>/2019/11/29/MySQL%E4%BA%92%E4%B8%BA%E4%B8%BB%E4%BB%8E-GTID/</url>
    <content><![CDATA[<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GTID互为主从</span></pre></td></tr><tr><td class="code"><pre><span class="line">数据库版本mysql-5.7.25 192.168.206.129 192.168.206.138，源码安装</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># service mysqld stop</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/my.cnf    //确保以下配置,server不能一样</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">server_id = 138</span></pre></td></tr><tr><td class="code"><pre><span class="line">gtid_mode = on</span></pre></td></tr><tr><td class="code"><pre><span class="line">enforce_gtid_consistency = 1</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">log</span>-bin=mysqld-bin</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">server_id = 129</span></pre></td></tr><tr><td class="code"><pre><span class="line">gtid_mode = on</span></pre></td></tr><tr><td class="code"><pre><span class="line">enforce_gtid_consistency = 1</span></pre></td></tr><tr><td class="code"><pre><span class="line"><span class="built_in">log</span>-bin=mysqld-bin				//不指定路径即为数据库data目录下mysqld-bin</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># service mysqld start</span></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysql -uroot -p</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">创建给从服务器连接自己的用户,给予复制权限</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; create user <span class="string">'xzj'</span>@<span class="string">'%'</span> identified by <span class="string">'123'</span>;	//%为局域网内所有机器，可写ip</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to <span class="string">'xzj'</span>@<span class="string">'%'</span>;</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">192.168.206.138执行</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show master status\G</span></pre></td></tr><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span></pre></td></tr><tr><td class="code"><pre><span class="line">             File: mysqld-bin.000012</span></pre></td></tr><tr><td class="code"><pre><span class="line">         Position: 745</span></pre></td></tr><tr><td class="code"><pre><span class="line">     Binlog_Do_DB: </span></pre></td></tr><tr><td class="code"><pre><span class="line"> Binlog_Ignore_DB: </span></pre></td></tr><tr><td class="code"><pre><span class="line">Executed_Gtid_Set: 1e795453-6320-11e9-b789-000c29a006aa:1-3</span></pre></td></tr><tr><td class="code"><pre><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; CHANGE MASTER TO</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_HOST=<span class="string">'192.168.206.129'</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_USER=<span class="string">'xzj'</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_PASSWORD=<span class="string">'123'</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_LOG_FILE=<span class="string">'mysqld-bin.000008'</span>,		//和129show master status对应</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_LOG_POS=745;						//和129show master status对应</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">192.168.206.129执行</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show master status\G</span></pre></td></tr><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span></pre></td></tr><tr><td class="code"><pre><span class="line">             File: mysqld-bin.000008</span></pre></td></tr><tr><td class="code"><pre><span class="line">         Position: 745</span></pre></td></tr><tr><td class="code"><pre><span class="line">     Binlog_Do_DB: </span></pre></td></tr><tr><td class="code"><pre><span class="line"> Binlog_Ignore_DB: </span></pre></td></tr><tr><td class="code"><pre><span class="line">Executed_Gtid_Set: 1e795453-6320-11e9-b789-000c29a006aa:1-3</span></pre></td></tr><tr><td class="code"><pre><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; CHANGE MASTER TO</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_HOST=<span class="string">'192.168.206.138'</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_USER=<span class="string">'xzj'</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_PASSWORD=<span class="string">'123'</span>,</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_LOG_FILE=<span class="string">'mysqld-bin.000012'</span>,   //和138上show master对应</span></pre></td></tr><tr><td class="code"><pre><span class="line">    -&gt; MASTER_LOG_POS=745;					//和138上show master对应</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">----------------------------------------------------------------------</span></pre></td></tr><tr><td class="code"><pre><span class="line">129：</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; start slave;</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span></pre></td></tr><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span></pre></td></tr><tr><td class="code"><pre><span class="line">               Slave_IO_State: </span></pre></td></tr><tr><td class="code"><pre><span class="line">                  Master_Host: 192.168.206.138</span></pre></td></tr><tr><td class="code"><pre><span class="line">                  Master_User: xzj</span></pre></td></tr><tr><td class="code"><pre><span class="line">                  Master_Port: 3306</span></pre></td></tr><tr><td class="code"><pre><span class="line">                Connect_Retry: 60</span></pre></td></tr><tr><td class="code"><pre><span class="line">              Master_Log_File: mysqld-bin.000012</span></pre></td></tr><tr><td class="code"><pre><span class="line">          Read_Master_Log_Pos: 745</span></pre></td></tr><tr><td class="code"><pre><span class="line">               Relay_Log_File: localhost-relay-bin.000001</span></pre></td></tr><tr><td class="code"><pre><span class="line">                Relay_Log_Pos: 4</span></pre></td></tr><tr><td class="code"><pre><span class="line">        Relay_Master_Log_File: mysqld-bin.000012</span></pre></td></tr><tr><td class="code"><pre><span class="line">             Slave_IO_Running: Yes</span></pre></td></tr><tr><td class="code"><pre><span class="line">            Slave_SQL_Running: Yes</span></pre></td></tr><tr><td class="code"><pre><span class="line">            ......</span></pre></td></tr><tr><td class="code"><pre><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">----------------------------------------------------------------------</span></pre></td></tr><tr><td class="code"><pre><span class="line">138：</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; start slave；</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span></pre></td></tr><tr><td class="code"><pre><span class="line">*************************** 1. row ***************************</span></pre></td></tr><tr><td class="code"><pre><span class="line">               Slave_IO_State: </span></pre></td></tr><tr><td class="code"><pre><span class="line">                  Master_Host: 192.168.206.129</span></pre></td></tr><tr><td class="code"><pre><span class="line">                  Master_User: xzj</span></pre></td></tr><tr><td class="code"><pre><span class="line">                  Master_Port: 3306</span></pre></td></tr><tr><td class="code"><pre><span class="line">                Connect_Retry: 60</span></pre></td></tr><tr><td class="code"><pre><span class="line">              Master_Log_File: mysqld-bin.000012</span></pre></td></tr><tr><td class="code"><pre><span class="line">          Read_Master_Log_Pos: 194</span></pre></td></tr><tr><td class="code"><pre><span class="line">               Relay_Log_File: localhost-relay-bin.000011</span></pre></td></tr><tr><td class="code"><pre><span class="line">                Relay_Log_Pos: 255</span></pre></td></tr><tr><td class="code"><pre><span class="line">        Relay_Master_Log_File: mysqld-bin.000012</span></pre></td></tr><tr><td class="code"><pre><span class="line">             Slave_IO_Running: Yes</span></pre></td></tr><tr><td class="code"><pre><span class="line">            Slave_SQL_Running: Yes</span></pre></td></tr><tr><td class="code"><pre><span class="line">             ......</span></pre></td></tr><tr><td class="code"><pre><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">注意事项</span></pre></td></tr><tr><td class="code"><pre><span class="line">auto.cnf里uuid是否一致，若一致则配置主从失败,若有数据，做主从前先迁移数据,一般为/var/lib/mysql/auto.cnf</span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@mysql ~]<span class="comment"># mysqldump -uroot -p123 --all-databases &gt; alldb.sql</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">如果导出不了</span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@mysql ~]<span class="comment"># mysql_upgrade -uroot -p123 force</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">从库导入</span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@mysql ~]<span class="comment"># mysql -uroot -p123 &lt; alldb.sql</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">*暴力拷贝,拷贝库文件夹和db*</span></pre></td></tr><tr><td class="code"><pre><span class="line">1、拷贝原数据到目标目录后，记得将权限改为mysql</span></pre></td></tr><tr><td class="code"><pre><span class="line">2、uuid 需要修改，但是要在启动mysql成功之后再进行修改</span></pre></td></tr><tr><td class="code"><pre><span class="line">3、初始化密码未修改时，不能关闭密码强度策略</span></pre></td></tr><tr><td class="code"><pre><span class="line">4、密码强度策略不能和跳过密码配置同时添加</span></pre></td></tr><tr><td class="code"><pre><span class="line">5、初始化之前必须先停用mysql，然后把数据目录全部清理掉</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">reset master</span></pre></td></tr><tr><td class="code"><pre><span class="line">删除所有的binglog日志文件，并将日志索引文件清空，重新开始所有新的日志文件。用于第一次进行搭建主从库时，进行主库binlog初始化工作，不能用于有任何slave 正在运行的主从关系的主库</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">reset slave</span></pre></td></tr><tr><td class="code"><pre><span class="line">用于删除SLAVE数据库的relaylog日志文件，并重新启用新的relaylog文件，使用reset slave之前必须使用stop slave 命令将复制进程停止</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">重置主从，用于主从异常，且无法解决时，相当于遇到电脑问题时暴力重装</span></pre></td></tr><tr><td class="code"><pre><span class="line">1. 停止slave服务器的主从同步</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; STOP SLAVE;</span></pre></td></tr><tr><td class="code"><pre><span class="line">2.对master服务器的数据库加锁</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; FLUSH TABLES WITH READ LOCK;</span></pre></td></tr><tr><td class="code"><pre><span class="line">3.备份master上的数据</span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@mysql ~]<span class="comment"># mysqldump -uroot -p --all-databases &gt; alldb.sql</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">4.重置master服务</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; RESET MASTER;</span></pre></td></tr><tr><td class="code"><pre><span class="line">5.对master服务器的数据库解锁</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; UNLOCK TABLES;</span></pre></td></tr><tr><td class="code"><pre><span class="line">6.将master上的备份文件拷贝到slave服务器上</span></pre></td></tr><tr><td class="code"><pre><span class="line">[root@mysql ~]<span class="comment"># scp -r root@XXX.XXX.XXX.<span class="doctag">XXX:</span>/root/bak.sql ./</span></span></pre></td></tr><tr><td class="code"><pre><span class="line">7.删除slave服务器上的旧数据</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; DROP DATABASE db1;</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; DROP DATABASE db2;</span></pre></td></tr><tr><td class="code"><pre><span class="line">8.导入数据</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; SOURCE /root/bak.sql;</span></pre></td></tr><tr><td class="code"><pre><span class="line">9.重置slave服务</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; RESET SLAVE;</span></pre></td></tr><tr><td class="code"><pre><span class="line">10.开启slave服务</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; START SLAVE;</span></pre></td></tr><tr><td class="code"><pre><span class="line">11.检查同步转态</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; SHOW SLAVE STATUS\G</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">如果不能同步，或者之前的<span class="built_in">log</span>-bin 丢失，可以使用新的同步点，步骤如下:(保证两个数据库数据一致,若不一致会失败,解决方法在最后)</span></pre></td></tr><tr><td class="code"><pre><span class="line">从服务器操作：</span></pre></td></tr><tr><td class="code"><pre><span class="line">停止slave</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; stop slave;</span></pre></td></tr><tr><td class="code"><pre><span class="line">主服务器刷新日志：</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; flush logs;</span></pre></td></tr><tr><td class="code"><pre><span class="line">查看主服务器日志点记录下：file 和position 位置；</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show master status\G;</span></pre></td></tr><tr><td class="code"><pre><span class="line">切换到从服务器，修改从服务器同步点</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">'mysqld-bin.000013'</span>,MASTER_LOG_POS=194;</span></pre></td></tr><tr><td class="code"><pre><span class="line">启动从服务器：</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; start slave;</span></pre></td></tr><tr><td class="code"><pre><span class="line">查看从服务器同步状态：</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G;</span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="code"><pre><span class="line">若两个数据库数据不一直，且主从正常，说明在重置主从期间，主服务器产生了新的数据，且读取的bin-log为写入新数据后产生的，此时从服务器就同步不了之前主服务器的数据，导致数据不一致，结局方法为改变读取的binlog和pos值。如</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; show binlog events <span class="keyword">in</span> <span class="string">'mysqld-bin.000001'</span>;	//查看一个较早的bin-log日志（要确定产生此bin-log日志时数据是完全一致的）</span></pre></td></tr><tr><td class="code"><pre><span class="line">+-------------------+-----+----------------+-----------+-------------+---------------------------------------+</span></pre></td></tr><tr><td class="code"><pre><span class="line">| Log_name          | Pos | Event_type     | Server_id | End_log_pos | Info                                  |</span></pre></td></tr><tr><td class="code"><pre><span class="line">+-------------------+-----+----------------+-----------+-------------+---------------------------------------+</span></pre></td></tr><tr><td class="code"><pre><span class="line">| mysqld-bin.000001 |   4 | Format_desc    |        11 |         123 | Server ver: 5.7.25-log, Binlog ver: 4 |</span></pre></td></tr><tr><td class="code"><pre><span class="line">| mysqld-bin.000001 | 123 | Previous_gtids |        11 |         154 |                                       |</span></pre></td></tr><tr><td class="code"><pre><span class="line">| mysqld-bin.000001 | 154 | Stop           |        11 |         177 |                                       |</span></pre></td></tr><tr><td class="code"><pre><span class="line">+-------------------+-----+----------------+-----------+-------------+---------------------------------------+</span></pre></td></tr><tr><td class="code"><pre><span class="line">mysql&gt; CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">'mysqld-bin.000001'</span>,MASTER_LOG_POS=4;	//修改读取的bin-log和对应的pos值，使从服务器从此时开始读取，便可重新同步数据</span></pre></td></tr></table></figure>

]]></content>
  </entry>
</search>
